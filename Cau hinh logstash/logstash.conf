input {
  file {
    path => "/var/log/suricata/eve.json"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => "json"
  }
}

filter {
  # Gán nhãn cho các loại log Suricata
  if [event_type] == "alert" {
    mutate {
      add_tag => ["suricata-alert"]
    }

    # Phân loại cảnh báo
    if [alert][severity] <= 2 {
      mutate { add_tag => ["critical"] }
    } else if [alert][severity] == 3 {
      mutate { add_tag => ["medium"] }
    } else {
      mutate { add_tag => ["low"] }
    }

    # Phân loại giao thức
    if [alert][signature] =~ /ICMP/ {
      mutate { add_tag => ["icmp-traffic"] }
    }
    if [alert][signature] =~ /DNS/ {
      mutate { add_tag => ["dns-traffic"] }
    }
    if [alert][signature] =~ /SSH/ {
      mutate { add_tag => ["ssh-traffic"] }
    }
  }

  # Chuẩn hóa timestamp
  if [@timestamp] {
    date {
      match => ["@timestamp", "ISO8601"]
    }
  }

  # Xóa field rác không cần thiết (nếu có)
  mutate {
    remove_field => ["host", "path", "@version"]
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "suricata-%{+YYYY.MM.dd}"
  }

  # Dễ debug khi cần kiểm tra lỗi log
  stdout { codec => rubydebug }
}
